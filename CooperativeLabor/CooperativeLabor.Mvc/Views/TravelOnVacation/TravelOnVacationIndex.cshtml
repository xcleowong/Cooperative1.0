@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>差旅休假</title>
    <script src="~/Scripts/jquery-3.3.1.js"></script>
    <link href="~/BootstrapSouce/css/bootstrap.css" rel="stylesheet" />
    <script src="~/Content/My97DatePicker/My97DatePicker/WdatePicker.js"></script>
</head>
<body>
    <div>
        <div id="app">
            &nbsp;&nbsp;&nbsp;&nbsp;
            <input type="button" class="btn" value="+差旅休假" onclick="addBtn()" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <table class="table-condensed" border="1" style="width:100%">
                <thead>
                    <tr>
                        <th>序号</th>
                        <th>申请类型</th>
                        <th>申请事由</th>
                        <th>开始时间</th>
                        <th>结束时间</th>
                        <th>计算时长</th>
                        <th>申请日期</th>
                        <th>状态</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="tabody"></tbody>
            </table>
            <div id="addDiv">
                <form action="/" method="post" id="form1">
                    <table class="table-condensed" style="width:50%">
                        <tr hidden="hidden">
                            <td></td>
                            <td>
                                <input class="Text1" type="text" name="State" value="1" />
                                <input class="Text1" type="text" name="StaffId" />
                            </td>
                        </tr>
                        <tr>
                            <td>姓名：</td>
                            <td>
                                <input class="Text1" type="text" name="Name" readonly='readonly' />
                            </td>
                        </tr>
                        <tr>
                            <td>申请类型：</td>
                            <td>
                                <select class="select1" name="ApplicationType">
                                    <option value="出差">出差</option>
                                    <option value="休假">休假</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>申请事由：</td>
                            <td>
                                <textarea class="Text1" name="ApplicationReason"></textarea>
                            </td>
                        </tr>
                        <tr>
                            <td>开始时间：</td>
                            <td>
                                <input id="startTime" class="Wdate clickTime" type="text" name="StartTime" onclick="WdatePicker({minDate:'%y-%M-#{%d}', maxDate:'#F{$dp.$D(\'endTime\')||\'2020-10-01\'}'})" readOnly="readOnly" />
                            </td>
                        </tr>
                        <tr>
                            <td>结束时间：</td>
                            <td>
                                <input id="endTime" class="Wdate clickTime" type="text" name="EndTime" onclick="WdatePicker({minDate:'%y-%M-#{%d}' , minDate:'#F{$dp.$D(\'startTime\')}',maxDate:'2020-10-01'})" readOnly="readOnly" />
                            </td>
                        </tr>
                        <tr>
                            <td>计算时长：</td>
                            <td>
                                <input class="Text1" type="text" name="ComputingTime" />
                            </td>
                        </tr>
                        <tr>
                            <td>申请日期：</td>
                            <td>
                                <input class="" type="text" name="ApplicationDate" readonly='readonly' />
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>
                                <input id="AddBtn" type="button" value="提交" onclick="addTravelOnVacation()" />
                            </td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>
    </div>
</body>
</html>

<script type="text/javascript">
    //登录人ID
    var StaffId = 1;
    var StaffName = "张三";//登录人姓名
    $(function () {
        getTravelOnVacation(StaffId);//显示
    });
    
    //显示
    function getTravelOnVacation(StaffId) {
        $.ajax({
            url: 'http://localhost:8099/travelOnVacation/getTravelOnVacation?StaffId=' + StaffId,
            type: 'get',
            success: function (data) {
                $("#tabody").html("");
                var index = 0;
                for (var i = 0; i < data.length; i++) {
                    var tabody = '<tr>'
                        + '<td>' + (index + 1) + '</td>'
                        + '<td>' + data[i].ApplicationType + '</td>'
                        + '<td>' + data[i].ApplicationReason + '</td>'
                        + '<td>' + data[i].StartTime + '</td>'
                        + '<td>' + data[i].EndTime + '</td>'
                        + '<td>' + data[i].ComputingTime + '</td>'
                        + '<td>' + data[i].ApplicationDate + '</td>'
                        + '<td>' + data[i].StrState + '</td>'
                        + '<td><a href="javascript:void(0)" onclick="deleteOrRecall(' + data[i].Id + ',' + data[i].State + ', ' + StaffId + ')">' + data[i].ReverseStrState + '</a></td>'
                        + '</tr>';
                    $("#tabody").append(tabody);
                }
            }
        })
    };

    //显示添加控件
    function addBtn() {
        $("[name=StaffId]").val(StaffId);//赋值用户ID
        $("[name=Name]").val(StaffName);//赋值姓名
        var myDate = new Date();//获取系统当前时间
        //var datetime = myDate.toLocaleString();//获取当前日期时间
        //获取当前日期时间
        var datetime = myDate.getFullYear() + '-' + myDate.getMonth() + 1 + '-' + myDate.getDate() + ' ' + myDate.getHours() + ':' + myDate.getMinutes() + ':' + myDate.getSeconds();
        $("[name=ApplicationDate]").val(datetime);//赋值姓名
    }

    //添加差旅休假
    function addTravelOnVacation() {
        $.ajax({
            url: 'http://localhost:8099/travelOnVacation/addTravelOnVacation',
            type: 'post',
            data: $("#form1").serialize(),
            success: function (data) {
                if (data > 0) {
                    alert("提交成功！");
                    getTravelOnVacation(StaffId);
                }
                else {
                    alert("提交失败！");
                }
            }
        })
    };

    //删除/撤回 差旅休假
    function deleteOrRecall(id, state, staffId) {
        var msg, msg1 = "";
        if (state == 1) {
            msg = "确认撤回吗？";
            msg1 = "撤回";
        }
        if (state == 2) {
            msg = "确认删除吗？";
            msg1 = "删除";
        }
        if (confirm(msg)) {
            $.ajax({
                url: 'http://localhost:8099/travelOnVacation/updateTravelOnVacation?Id=' + id + '&State=' + state,
                type: 'post',
                success: function (data) {
                    if (data > 0) {
                        alert(msg1 + "成功！");
                        getTravelOnVacation(staffId);
                    }
                    else {
                        alert(msg1 + "失败！");
                    }
                }
            })
        }
    };

</script>